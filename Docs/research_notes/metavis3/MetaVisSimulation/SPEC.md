# MetaVisSimulation Specification

## Overview
MetaVisSimulation is the "Engine" that renders the pixels. It executes the `NodeGraph` generated by the Timeline, applying physics-based rendering (PBR), ACES color management, and simulation effects.

## 1. Render Nodes
**Goal:** Implement the low-level processing nodes.

### Components
*   **`CameraNode`:**
    *   Simulates Lens Distortion, Chromatic Aberration, Depth of Field.
    *   Driven by `CameraDevice` properties.
*   **`RelightNode`:**
    *   Uses Depth Map + Normal Map to apply virtual lights.
    *   Driven by `LightDevice` properties.
*   **`FluidNode`:**
    *   Simulates fluids/particles.
    *   Driven by `GeneratorDevice` properties.

### Implementation Plan
*   [ ] Implement `CameraNode` (Metal Shader).
*   [ ] Implement `RelightNode` (Metal Shader).

## 2. Color Pipeline
**Goal:** Ensure industry-standard color accuracy.

### Components
*   **`ACESPipeline` (Existing):**
    *   Handles IDT (Input Device Transform) and ODT (Output Device Transform).
*   **`ColorMatchSolver` (Existing):**
    *   Math logic for matching histograms (used by Perception).

### Implementation Plan
*   [x] `ColorMatchSolver` implemented.
*   [ ] Verify ACES pipeline supports new `DisplayDevice` profiles (e.g. XDR).

## 3. Performance
**Goal:** Scale from iPhone to Mac Studio.

### Components
*   **`QualityContext`:**
    *   Global setting (Draft, Preview, High).
    *   Nodes adjust their sampling rate based on this context.

### Implementation Plan
*   [ ] Implement `QualityContext` injection into Render Graph.

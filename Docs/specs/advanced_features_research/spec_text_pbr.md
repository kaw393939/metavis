# Spec: Cinematic Text (SDF + PBR)

## 1. Objective
Implement a "Super-Resolution" text rendering engine compatible with the PBR lighting system. Text should not be a flat 2D overlay but a physical object in the scene that reflects light (e.g., Gold titles, Glass letters).

## 2. Technical Approach
Based on `metavis1/Sources/MetalVisCore/Shaders/SDFText.metal`.

### 2.1 Geometry: MSDF (Multi-channel Signed Distance Field)
*   **Format**: `MTSDF` (Merges MSDF in RGB for sharp corners + True SDF in Alpha for outlines).
*   **Rendering**:
    *   Sample texture -> `median(r, g, b)` -> Distance.
    *   Compute screen-space derivatives `fwidth(Distance)` to determine AA softness.
    *   `smoothstep` to isolate the glyph shape.

### 2.2 Lighting: PBR Integration (New)
The legacy system rendered text as flat unlit color with properties. The new system will treat the Text Quad as a surface for the **Disney BRDF**.

*   **PBR Inputs derived from SDF**:
    *   **Normal Map**: Compute the gradient of the distance field to generate a "beveled" normal at the edges.
        *   `N = normalize(float3(-ddx(dist), -ddy(dist), edgeWidth))`
    *   **Alpha**: Driven by the SDF shape.
    *   **Material**: The user assigns a `PBRMaterial` (e.g., Gold) to the text string.

### 2.3 Features
*   **Infinite Zoom**: Edges remain sharp at any scale.
*   **Outlines**: Generated procedurally in the shader (`smoothstep` at a different distance threshold).
*   **Soft Shadows**: Generated by offsetting the SDF sample and blurring (`smoothstep` with wider edge).

## 3. Implementation Plan
1.  **SDF Generator**: Port `SDFGenerator.swift` (CPU) to generate atlases from `CoreText` / `freetype`.
2.  **Shader**: Merge `SDFText.metal` logic into the `PBR.metal` fragment shader (or a specialized `PBRText.metal` variant).
3.  **Component**: Create `Text3D` component in `MetaVisGraphics`.

## 4. Acceptance Criteria
*   **Legibility**: Text must be crisp at 4K, even when small.
*   **Lighting**: A rotating light source should cause specular highlights to travel across the face of the letters (if Metallic).
*   **Artifacts**: No "wobbly" corners (MSDF correctness).
